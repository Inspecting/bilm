<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000000" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="/bilm.github.io/manifest.json" />
  <link rel="apple-touch-icon" href="/bilm.github.io/icon.png" />
  <title>TV Viewer | Bilm</title>
  <style>
    body {
      background-color: #000;
      color: white;
      margin: 0;
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    #videoContainer {
      position: relative;
      width: 100%;
      height: 70vh;
      background: #111;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    #controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    button {
      background: none;
      border: 2px solid #6f00ff;
      color: white;
      padding: 10px 15px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    button:hover {
      background: #6f00ff;
      box-shadow: 0 0 15px #6f00ff;
    }
    #serverInfo {
      margin-top: 10px;
      font-size: 0.9em;
      color: #aaa;
    }
    select {
      background: #111;
      color: white;
      border: 2px solid #6f00ff;
      border-radius: 10px;
      padding: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="navbar"></div>

  <div id="videoContainer">
    <iframe id="videoIframe" allowfullscreen></iframe>
  </div>

  <div id="controls">
    <button id="prevEpisode">⟸ Episode</button>
    <button id="nextEpisode">Episode ⟹</button>
    <select id="seasonSelect"></select>
    <select id="episodeSelect"></select>
    <button id="changeServer">Change Server</button>
  </div>

  <div id="serverInfo">Server: <span id="currentServer">VidSrc 1</span></div>

  <script>
    // Load shared navbar
    fetch('/bilm.github.io/shared/navbar.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('navbar').innerHTML = data;
        const script = document.createElement('script');
        script.src = '/bilm.github.io/shared/navbar.js';
        document.body.appendChild(script);
      });

    const urlParams = new URLSearchParams(window.location.search);
    const tvID = urlParams.get('id');
    const imdbID = urlParams.get('imdb') || '';
    let currentSeason = parseInt(urlParams.get('season')) || 1;
    let currentEpisode = parseInt(urlParams.get('episode')) || 1;

    const servers = [
      { name: 'VidSrc 1', domain: 'vidsrcme.ru' },
      { name: 'VidSrc 2', domain: 'vidsrcme.su' },
      { name: 'VidSrc 3', domain: 'vidsrc-me.ru' },
      { name: 'VidSrc 4', domain: 'vidsrc-me.su' },
      { name: 'VidSrc 5', domain: 'vidsrc-embed.ru' },
      { name: 'VidSrc 6', domain: 'vidsrc-embed.su' },
      { name: 'VidSrc 7', domain: 'vsrc.su' },
      { name: 'VidPlay', domain: 'vidplay.to' }
    ];

    let currentServerIndex = 0;

    function updateIframe() {
      const iframe = document.getElementById('videoIframe');
      const idToUse = imdbID || tvID;
      const server = servers[currentServerIndex];

      if (server.name.startsWith('VidSrc')) {
        iframe.src = `https://${server.domain}/embed/tv/${idToUse}/${currentSeason}/${currentEpisode}`;
      } else if (server.name === 'VidPlay') {
        iframe.src = `https://${server.domain}/tv/${idToUse}/${currentSeason}/${currentEpisode}`;
      }

      document.getElementById('currentServer').innerText = server.name;
      localStorage.setItem(`tv_${tvID}_progress`, JSON.stringify({ season: currentSeason, episode: currentEpisode }));
    }

    function changeServer(direction = 1) {
      currentServerIndex = (currentServerIndex + direction + servers.length) % servers.length;
      updateIframe();
    }

    document.getElementById('changeServer').addEventListener('click', () => changeServer(1));

    function setupSelectors(totalSeasons = 10, episodesPerSeason = 10) {
      const seasonSelect = document.getElementById('seasonSelect');
      const episodeSelect = document.getElementById('episodeSelect');
      seasonSelect.innerHTML = '';
      episodeSelect.innerHTML = '';

      for (let i = 1; i <= totalSeasons; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `Season ${i}`;
        seasonSelect.appendChild(opt);
      }

      for (let i = 1; i <= episodesPerSeason; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `Episode ${i}`;
        episodeSelect.appendChild(opt);
      }

      seasonSelect.value = currentSeason;
      episodeSelect.value = currentEpisode;

      seasonSelect.addEventListener('change', () => {
        currentSeason = parseInt(seasonSelect.value);
        currentEpisode = 1;
        episodeSelect.value = 1;
        updateIframe();
      });

      episodeSelect.addEventListener('change', () => {
        currentEpisode = parseInt(episodeSelect.value);
        updateIframe();
      });
    }

    document.getElementById('prevEpisode').addEventListener('click', () => {
      if (currentEpisode > 1) {
        currentEpisode--;
        document.getElementById('episodeSelect').value = currentEpisode;
        updateIframe();
      }
    });

    document.getElementById('nextEpisode').addEventListener('click', () => {
      currentEpisode++;
      document.getElementById('episodeSelect').value = currentEpisode;
      updateIframe();
    });

    window.addEventListener('load', () => {
      const savedProgress = JSON.parse(localStorage.getItem(`tv_${tvID}_progress`));
      if (savedProgress) {
        currentSeason = savedProgress.season;
        currentEpisode = savedProgress.episode;
      }
      setupSelectors();
      updateIframe();
    });
  </script>
</body>
</html>
