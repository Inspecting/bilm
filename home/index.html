<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bilm ðŸ’œ</title>

  <!-- PWA & iOS fullscreen meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0a0a0a" />

  <!-- Manifest & Apple Touch Icon -->
  <link rel="manifest" href="/bilm/manifest.json" />
  <link rel="apple-touch-icon" href="/bilm/icon.png" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet" />

  <!-- Theme styles -->
  <link rel="stylesheet" href="/bilm/shared/theme.css" />

  <!-- Your existing home page styles -->
  <link rel="stylesheet" href="/bilm/home/style.css" />

  <script src="/bilm/shared/theme.js"></script>
</head>
<body>

  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <!-- Navbar placeholder (same ID as search.html) -->
  <div id="navbar-placeholder"></div>

  <main>
    <div class="search-container">
      <h1>
        <img class="heart-icon" src="https://icons.iconarchive.com/icons/microsoft/fluentui-emoji-3d/128/Purple-Heart-3d-icon.png" alt="Heart" style="height: 1em; vertical-align: middle; margin-right: 8px;" />
        Bilm
        <img class="heart-icon" src="https://icons.iconarchive.com/icons/microsoft/fluentui-emoji-3d/128/Purple-Heart-3d-icon.png" alt="Heart" style="height: 1em; vertical-align: middle; margin-left: 8px;" />
      </h1>
      <input id="searchInput" type="search" placeholder="Search movies or TV shows..." autocomplete="off" />
      <div class="button-row">
        <button class="search-btn" id="searchBtn">Search</button>
      </div>
    </div>

    <section class="section" id="continueWatchingSection">
      <div class="section-header">
        <div class="section-title-row">
          <h2 class="section-title">Continue Watching</h2>
          <div class="section-actions">
            <button class="section-btn section-btn-compact" id="continueEditBtn" type="button">Edit</button>
            <button class="section-btn section-btn-danger" id="continueRemoveBtn" type="button" disabled hidden>Remove selected</button>
          </div>
        </div>
      </div>
      <div class="subsection">
        <h3 class="subsection-title">Movies</h3>
        <div class="scroll-row" id="continueMovies"></div>
      </div>
      <div class="subsection">
        <h3 class="subsection-title">TV Shows</h3>
        <div class="scroll-row" id="continueTv"></div>
      </div>
    </section>

    <section class="section" id="favoritesSection">
      <div class="section-header">
        <div class="section-title-row">
          <h2 class="section-title">Favorites</h2>
          <div class="section-actions">
            <button class="section-btn section-btn-compact" id="favoritesEditBtn" type="button">Edit</button>
            <button class="section-btn section-btn-danger" id="favoritesRemoveBtn" type="button" disabled hidden>Remove selected</button>
          </div>
        </div>
      </div>
      <div class="subsection">
        <h3 class="subsection-title">Movies</h3>
        <div class="scroll-row" id="favoriteMovies"></div>
      </div>
      <div class="subsection">
        <h3 class="subsection-title">TV Shows</h3>
        <div class="scroll-row" id="favoriteTv"></div>
      </div>
    </section>
  </main>

  <!-- Load shared navbar HTML + CSS + JS dynamically like search.html -->
  <script>
    fetch('/bilm/shared/navbar.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('navbar-placeholder').innerHTML = html;

        // Load navbar CSS
        const css = document.createElement('link');
        css.rel = 'stylesheet';
        css.href = '/bilm/shared/navbar.css';
        document.head.appendChild(css);

        // Load navbar JS
        const script = document.createElement('script');
        script.src = '/bilm/shared/navbar.js';
        document.body.appendChild(script);
      });
  </script>

  <script src="/bilm/shared/history.js"></script>
  <script src="/bilm/home/script.js"></script>

  <!-- Particle effect -->
  <script>
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    const dotCount = 80;
    let dots = [];
    let animationId = null;
    let particlesEnabled = true;
    let motionEnabled = true;

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function initDots() {
      dots = [];
      for (let i = 0; i < dotCount; i++) {
        dots.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          r: Math.random() * 2 + 1,
          dx: (Math.random() - 0.5) * 0.7,
          dy: (Math.random() - 0.5) * 0.7,
        });
      }
    }

    function renderFrame(shouldMove = true) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.shadowColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#c084fc';
      ctx.shadowBlur = 8;

      for (let dot of dots) {
        ctx.beginPath();
        ctx.arc(dot.x, dot.y, dot.r, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(193, 132, 252, 0.9)';
        ctx.fill();

        if (shouldMove) {
          dot.x += dot.dx;
          dot.y += dot.dy;

          if (dot.x < 0 || dot.x > canvas.width) dot.dx *= -1;
          if (dot.y < 0 || dot.y > canvas.height) dot.dy *= -1;
        }
      }

      ctx.shadowBlur = 0;
    }

    function animate() {
      renderFrame(true);
      animationId = requestAnimationFrame(animate);
    }

    function stopAnimation() {
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
    }

    function applyParticleSettings(settings) {
      particlesEnabled = settings?.particles !== false;
      motionEnabled = settings?.motion !== false;
      canvas.style.display = particlesEnabled ? 'block' : 'none';

      stopAnimation();
      if (!particlesEnabled) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        return;
      }

      resize();
      initDots();

      if (motionEnabled) {
        animate();
      } else {
        renderFrame(false);
      }
    }

    window.addEventListener('resize', () => {
      if (!particlesEnabled) return;
      resize();
      initDots();
      if (!motionEnabled) renderFrame(false);
    });

    window.addEventListener('bilm:theme-changed', (event) => {
      applyParticleSettings(event.detail);
    });

    window.addEventListener('DOMContentLoaded', () => {
      const settings = window.bilmTheme?.getSettings?.();
      applyParticleSettings(settings);
    });
  </script>

</body>
</html>
