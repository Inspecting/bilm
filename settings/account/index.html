<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bilm üíú - Account Settings</title>
  <meta name="theme-color" content="#0a0a0a" />
  <link rel="manifest" href="../../manifest.json" />
  <link rel="apple-touch-icon" href="../../icon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../../shared/theme.css" />
  <link rel="stylesheet" href="./style.css" />
  <script src="../../shared/access.js"></script>
  <script src="../../shared/theme.js"></script>
</head>
<body>
  <div id="navbarContainer"></div>
  <main>
    <section class="account-shell">
      <header class="account-header">
        <h1>Account Settings</h1>
        <p>Manage login, data transfer, profile display, and account safety.</p>
      </header>

      <section class="panel">
        <h2>Status</h2>
        <p id="accountStatusText">Checking account status...</p>
        <p id="accountHintText" class="muted">Use this page to manage account sign-in, profile display, and account safety.</p>
        <div class="actions status-actions">
          <button id="signOutBtn" class="btn btn-outline" type="button" hidden>Sign Out</button>
        </div>
      </section>

      <section class="panel" id="authPanel">
        <h2>Account Access</h2>
        <div class="stack">
          <div class="actions">
            <button id="openLoginModalBtn" class="btn" type="button">Log In</button>
            <button id="openSignUpModalBtn" class="btn btn-outline" type="button">Sign Up</button>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Data Transfer</h2>
        <p class="muted">Export/import works with local data. Cloud actions use your signed-in account.</p>
        <div class="actions">
          <button id="exportDataBtn" class="btn" type="button">Export</button>
          <button id="importDataBtn" class="btn btn-outline" type="button">Import</button>
          <input id="importFileInput" type="file" accept="application/json,.json,text/plain" hidden />
        </div>
        <p id="transferStatusText" class="muted">No transfer action yet.</p>
      </section>

      <section class="panel">
        <h2>Merge Data</h2>
        <p class="muted">Combine two backup JSON exports into one merged import.</p>
        <div class="actions">
          <button id="openMergeModalBtn" class="btn btn-accent" type="button">Merge Data</button>
        </div>
      </section>

      <section class="panel">
        <h2>Sign Out Preferences</h2>
        <label class="switch-row" for="clearOnLogoutToggle">
          <span class="muted">Clear local site data after signing out</span>
          <span class="switch">
            <input id="clearOnLogoutToggle" type="checkbox" checked />
            <span class="switch-slider" aria-hidden="true"></span>
          </span>
        </label>
      </section>

      <section class="panel" id="profilePanel">
        <h2>Profile Display</h2>
        <div class="stack">
          <input id="usernameInput" type="text" maxlength="30" placeholder="Optional username for navbar display" autocomplete="nickname" />
          <button id="saveUsernameBtn" class="btn btn-outline" type="button">Save Username</button>
          <p class="muted">Display only.</p>
        </div>
      </section>

      <section class="panel danger-panel">
        <h2>Danger Zone</h2>
        <p class="muted">Delete account permanently from the site and remove account data.</p>
        <div class="stack">
          <input id="deletePassword" type="password" placeholder="Type password to confirm delete" autocomplete="current-password" />
          <button id="deleteAccountBtn" class="btn btn-danger" type="button">Delete Account</button>
        </div>
      </section>

      <p id="statusText" class="status" aria-live="polite"></p>
    </section>
  </main>

  <script src="../../shared/auth.js" defer></script>
  <script src="../../shared/navbar.js" defer></script>

  <div class="data-modal" id="loginModal" role="dialog" aria-modal="true" aria-labelledby="loginModalTitle">
    <div class="data-modal__panel">
      <h3 id="loginModalTitle">Log In</h3>
      <p>Use your email and password to log in.</p>
      <form id="loginForm" autocomplete="on">
        <div class="stack">
          <input id="loginEmail" name="email" type="email" placeholder="Email" autocomplete="email" />
          <input id="loginPassword" name="password" type="password" placeholder="Password" autocomplete="current-password" />
          <button id="toggleLoginPasswordBtn" class="btn btn-outline" type="button">Show Password</button>
        </div>
        <div class="actions modal-actions">
          <button id="loginBtn" class="btn" type="button">Log In</button>
          <button id="openCreateAccountBtn" class="btn btn-outline" type="button">Create an Account</button>
          <button id="closeLoginModalBtn" class="btn btn-outline" type="button">Close</button>
        </div>
      </form>
    </div>
  </div>

  <div class="data-modal" id="signUpModal" role="dialog" aria-modal="true" aria-labelledby="signUpModalTitle">
    <div class="data-modal__panel">
      <h3 id="signUpModalTitle">Sign Up</h3>
      <p>Create an account with your email and password.</p>
      <form id="signUpForm" autocomplete="on">
        <div class="stack">
          <input id="signUpEmail" name="email" type="email" placeholder="Email" autocomplete="email" />
          <input id="signUpPassword" name="password" type="password" placeholder="Password" autocomplete="new-password" />
          <button id="toggleSignUpPasswordBtn" class="btn btn-outline" type="button">Show Password</button>
        </div>
        <div class="actions modal-actions">
          <button id="signUpBtn" class="btn" type="button">Create Account</button>
          <button id="backToLoginBtn" class="btn btn-outline" type="button">Back to Log In</button>
          <button id="closeSignUpModalBtn" class="btn btn-outline" type="button">Close</button>
        </div>
      </form>
    </div>
  </div>

  <div class="data-modal" id="dataModal" role="dialog" aria-modal="true" aria-labelledby="dataModalTitle">
    <div class="data-modal__panel">
      <h3 id="dataModalTitle">Data Transfer</h3>
      <p id="dataModalMessage">Copy or download this backup JSON data.</p>
      <textarea id="dataCodeField" class="data-code" spellcheck="false"></textarea>
      <div class="actions modal-actions">
        <button id="copyDataBtn" class="btn" type="button" hidden>Copy Data</button>
        <button id="downloadDataBtn" class="btn btn-outline" type="button" hidden>Download File</button>
        <button id="cloudExportBtn" class="btn" type="button" hidden>‚òÅÔ∏è Export</button>
        <button id="pasteImportBtn" class="btn" type="button" hidden>Paste from Clipboard</button>
        <button id="uploadImportBtn" class="btn btn-outline" type="button" hidden>Upload Save File</button>
        <button id="cloudImportBtn" class="btn btn-outline" type="button" hidden>‚òÅÔ∏è Import</button>
        <button id="applyImportBtn" class="btn btn-outline" type="button" hidden>Apply Import</button>
        <button id="closeDataModalBtn" class="btn btn-outline" type="button">Close</button>
      </div>
    </div>
  </div>


  <div class="data-modal" id="mergeModal" role="dialog" aria-modal="true" aria-labelledby="mergeModalTitle">
    <div class="data-modal__panel">
      <h3 id="mergeModalTitle">Merge Data</h3>
      <p>Import two backup sources, then merge them into your local data.</p>
      <div class="merge-status-grid">
        <button id="importOneBtn" class="btn btn-outline" type="button">Import 1</button>
        <span id="importOneStatus" class="slot-status" aria-live="polite">‚óã Not loaded</span>
        <button id="importTwoBtn" class="btn btn-outline" type="button">Import 2</button>
        <span id="importTwoStatus" class="slot-status" aria-live="polite">‚óã Not loaded</span>
      </div>
      <div class="actions modal-actions">
        <button id="mergeDataBtn" class="btn btn-accent" type="button" disabled>Merge Data</button>
        <button id="closeMergeModalBtn" class="btn btn-outline" type="button">Close</button>
      </div>
    </div>
  </div>

  <div class="data-modal" id="cloudAuthPromptModal" role="dialog" aria-modal="true" aria-labelledby="cloudAuthPromptTitle">
    <div class="data-modal__panel">
      <h3 id="cloudAuthPromptTitle">Cloud action needs sign in</h3>
      <p>You're not logged in. Do you want to log in now before using cloud import/export?</p>
      <div class="actions modal-actions">
        <button id="confirmCloudLoginBtn" class="btn" type="button">Log In</button>
        <button id="cancelCloudLoginBtn" class="btn btn-outline" type="button">Cancel</button>
      </div>
    </div>
  </div>

  <script src="./script.js" defer></script>
</body>
</html>
