<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bilm üíú - Settings</title>

  <!-- PWA + iOS fullscreen support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0a0a0a" />

  <!-- PWA Manifest and Icon -->
  <link rel="manifest" href="../manifest.json" />
  <link rel="apple-touch-icon" href="../icon.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/bilm/shared/theme.css" />

  <style>
    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n\n    html,\n    body {\n      height: 100%;\n      font-family: 'Poppins', sans-serif;\n      background-color: var(--bg-main);\n      color: var(--text-primary);\n      overflow: hidden;\n    }\n\n    body {\n      display: flex;\n      flex-direction: column;\n    }\n\n    main {\n      flex: 1;\n      width: 100%;\n      overflow-y: auto;\n      overflow-x: hidden;\n      scrollbar-gutter: stable;\n      padding: 0;\n      display: flex;\n      justify-content: center;\n    }\n\n    .settings-content {\n      max-width: 1180px;\n      width: 100%;\n      margin: 0 auto;\n      padding: 32px 22px 90px;\n      overflow-y: auto;\n      overflow-x: hidden;\n      scrollbar-gutter: stable;\n    }\n\n    .page-header {\n      display: grid;\n      gap: 8px;\n      margin: 20px 0 28px;\n      padding: 20px 24px;\n      border-radius: var(--radius-lg);\n      background: linear-gradient(140deg, rgba(139, 92, 246, 0.15), transparent 60%),\n        var(--surface-1);\n      border: 1px solid var(--border);\n      box-shadow: var(--shadow-md);\n    }\n\n    .page-header h1 {\n      font-size: clamp(1.8rem, 3vw, 2.6rem);\n      color: var(--text-primary);\n    }\n\n    .page-header p {\n      color: var(--text-muted);\n      font-size: 1rem;\n    }\n\n    .settings-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));\n      gap: 20px;\n    }\n\n    .settings-card {\n      background: var(--surface-1);\n      border: 1px solid var(--border);\n      border-radius: var(--radius-lg);\n      padding: 20px;\n      box-shadow: var(--shadow-md);\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    .settings-card h2 {\n      font-size: 1.1rem;\n      color: var(--text-primary);\n    }\n\n    .settings-card p {\n      font-size: 0.9rem;\n      color: var(--text-muted);\n      line-height: 1.5;\n    }\n\n    .control-row {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 16px;\n      padding: 12px 14px;\n      border-radius: var(--radius-md);\n      background: var(--surface-2);\n      border: 1px solid transparent;\n      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);\n      flex-wrap: wrap;\n    }\n\n    .control-row:hover {\n      border-color: var(--accent-soft);\n      box-shadow: 0 0 12px var(--accent-soft);\n    }\n\n    .control-row label {\n      font-size: 0.95rem;\n      color: var(--text-primary);\n    }\n\n    .control-row > div {\n      min-width: 180px;\n      flex: 1 1 auto;\n    }\n\n    .control-row small {\n      display: block;\n      color: var(--text-subtle);\n      font-size: 0.75rem;\n    }\n\n    select,\n    input[type=\"color\"] {\n      background: rgba(255, 255, 255, 0.06);\n      border: 1px solid var(--border);\n      color: var(--text-primary);\n      border-radius: var(--radius-sm);\n      padding: 8px 10px;\n      font-family: inherit;\n    }\n\n    select:focus,\n    input[type=\"color\"]:focus {\n      outline: none;\n      border-color: var(--accent);\n      box-shadow: 0 0 10px var(--accent-soft);\n    }\n\n    .toggle {\n      position: relative;\n      width: 48px;\n      height: 26px;\n      flex: 0 0 auto;\n      margin-left: auto;\n    }\n\n    .toggle input {\n      opacity: 0;\n      width: 0;\n      height: 0;\n    }\n\n    .toggle span {\n      position: absolute;\n      inset: 0;\n      background: rgba(255, 255, 255, 0.1);\n      border-radius: 999px;\n      transition: background var(--transition-fast);\n      cursor: pointer;\n    }\n\n    .toggle span::after {\n      content: \"\";\n      position: absolute;\n      top: 3px;\n      left: 4px;\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      background: var(--text-primary);\n      transition: transform var(--transition-fast);\n      box-shadow: 0 0 8px rgba(0, 0, 0, 0.4);\n    }\n\n    .toggle input:checked + span {\n      background: linear-gradient(135deg, var(--accent), #4f46e5);\n      box-shadow: 0 0 12px var(--accent-glow);\n    }\n\n    .toggle input:checked + span::after {\n      transform: translateX(20px);\n    }\n\n    .preset-row {\n      display: flex;\n      gap: 10px;\n      flex-wrap: wrap;\n    }\n\n    .preset-btn {\n      width: 30px;\n      height: 30px;\n      border-radius: 50%;\n      border: 2px solid transparent;\n      cursor: pointer;\n      box-shadow: 0 0 10px rgba(0, 0, 0, 0.35);\n      transition: transform var(--transition-fast), border-color var(--transition-fast);\n    }\n\n    .preset-btn:hover {\n      transform: scale(1.08);\n      border-color: var(--text-primary);\n    }\n\n    .actions-row {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n    }\n\n    .btn {\n      padding: 10px 16px;\n      border-radius: var(--radius-sm);\n      border: none;\n      cursor: pointer;\n      font-weight: 600;\n      color: white;\n      background: linear-gradient(135deg, var(--accent), #4f46e5);\n      box-shadow: 0 10px 20px rgba(79, 70, 229, 0.35);\n      transition: transform var(--transition-fast), box-shadow var(--transition-fast);\n    }\n\n    .btn:hover {\n      transform: translateY(-1px);\n      box-shadow: 0 14px 26px rgba(79, 70, 229, 0.45);\n    }\n\n    .btn-outline {\n      background: transparent;\n      color: var(--text-primary);\n      border: 1px solid var(--border);\n      box-shadow: none;\n      text-decoration: none;\n    }\n\n    .btn-outline:hover {\n      box-shadow: 0 0 12px var(--accent-soft);\n    }\n\n    .btn-danger {\n      background: linear-gradient(135deg, #ef4444, #b91c1c);\n      box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);\n    }\n\n    @media (max-width: 720px) {\n      .settings-content {\n        padding: 20px 16px 80px;\n      }\n\n      .control-row {\n        align-items: flex-start;\n      }\n    }\n  </style>

  <script src="/bilm/shared/access.js"></script>
  <script src="/bilm/shared/theme.js"></script>
</head>
<body>

<div id="navbarContainer"></div>

<main>
  <div class="settings-content">
  <div class="page-header">
    <h1>Settings</h1>
    <p>Personalize the Bilm experience with your preferred theme, motion, and playback defaults.</p>
  </div>

  <div class="settings-grid">
    <section class="settings-card">
      <h2>Theme & Accent</h2>
      <p>Fine tune your accent glow and choose your background mode.</p>

      <div class="control-row">
        <div>
          <label for="accentPicker">Accent Color</label>
          <small>Pick a custom glow color.</small>
        </div>
        <input id="accentPicker" type="color" />
      </div>

      <div class="preset-row" id="accentPresets" aria-label="Accent color presets"></div>

      <div class="control-row">
        <div>
          <label for="backgroundSelect">Background Mode</label>
          <small>Pick a preset theme or build your own.</small>
        </div>
        <select id="backgroundSelect">
          <option value="deep">Deep</option>
          <option value="midnight">Midnight</option>
          <option value="velvet">Velvet</option>
          <option value="aurora">Aurora</option>
          <option value="slate">Slate</option>
          <option value="sunset">Sunset</option>
          <option value="custom">Custom</option>
        </select>
      </div>

      <div class="control-row" id="customBackgroundRow" hidden>
        <div>
          <label for="customBackgroundPicker">Custom Background</label>
          <small>Choose a custom background base color.</small>
        </div>
        <input id="customBackgroundPicker" type="color" />
      </div>
    </section>

    <section class="settings-card">
      <h2>Motion & Effects</h2>
      <p>Control animation and particle effects for performance and comfort.</p>

      <div class="control-row">
        <div>
          <label>Motion</label>
          <small>Reduce transitions and motion.</small>
        </div>
        <label class="toggle">
          <input id="motionToggle" type="checkbox" />
          <span></span>
        </label>
      </div>

      <div class="control-row">
        <div>
          <label>Particles</label>
          <small>Background particle shimmer on home.</small>
        </div>
        <label class="toggle">
          <input id="particleToggle" type="checkbox" />
          <span></span>
        </label>
      </div>
    </section>

    <section class="settings-card">
      <h2>Playback Defaults</h2>
      <p>Choose the default server for your viewer pages.</p>

      <div class="control-row">
        <div>
          <label for="serverSelect">Default Server</label>
          <small>Used for movies and TV viewers.</small>
        </div>
        <select id="serverSelect">
          <option value="vidsrc">VidSrc</option>
          <option value="godrive">GoDrive Player</option>
          <option value="multiembed">MultiEmbed</option>
        </select>
      </div>
    </section>

    <section class="settings-card">
      <h2>History & Privacy</h2>
      <p>Manage how Bilm saves search and watch history on this device.</p>

      <div class="control-row">
        <div>
          <label>View History</label>
          <small>Open your saved search and watch history.</small>
        </div>
        <a class="btn btn-outline" href="/bilm/settings/history">View History</a>
      </div>

      <div class="control-row">
        <div>
          <label>Incognito</label>
          <small>Temporarily pause search and watch history.</small>
        </div>
        <label class="toggle">
          <input id="incognitoToggle" type="checkbox" />
          <span></span>
        </label>
      </div>
    </section>

    <section class="settings-card">
      <h2>Reset & Maintenance</h2>
      <p>Restore defaults or clear all local data.</p>

      <div class="actions-row">
        <button class="btn btn-outline" id="resetThemeBtn">Reset Theme</button>
        <button class="btn btn-danger" id="resetDataBtn">Reset Data</button>
      </div>
    </section>
  </div>
  </div>
</main>

<script src="/bilm/shared/navbar.js" defer></script>

<script>
  const accentPresets = ['#8b5cf6', '#6366f1', '#22d3ee', '#f472b6', '#f59e0b'];
  const accentPicker = document.getElementById('accentPicker');
  const backgroundSelect = document.getElementById('backgroundSelect');
  const customBackgroundRow = document.getElementById('customBackgroundRow');
  const customBackgroundPicker = document.getElementById('customBackgroundPicker');
  const motionToggle = document.getElementById('motionToggle');
  const particleToggle = document.getElementById('particleToggle');
  const incognitoToggle = document.getElementById('incognitoToggle');
  const serverSelect = document.getElementById('serverSelect');
  const resetThemeBtn = document.getElementById('resetThemeBtn');
  const resetDataBtn = document.getElementById('resetDataBtn');
  const presetsContainer = document.getElementById('accentPresets');
  const supportedServers = ['vidsrc', 'godrive', 'multiembed'];

  function applySettings(partial) {
    const current = window.bilmTheme?.getSettings?.() || {};
    window.bilmTheme?.setSettings?.({ ...current, ...partial });
  }

  function syncUI() {
    const settings = window.bilmTheme?.getSettings?.() || {};
    accentPicker.value = settings.accent || '#8b5cf6';
    backgroundSelect.value = settings.background || 'deep';
    customBackgroundPicker.value = settings.customBackground || '#0b0f1a';
    customBackgroundRow.hidden = (settings.background || 'deep') !== 'custom';
    motionToggle.checked = settings.motion !== false;
    particleToggle.checked = settings.particles !== false;
    incognitoToggle.checked = settings.incognito === true;
    const preferredServer = settings.defaultServer || 'vidsrc';
    serverSelect.value = supportedServers.includes(preferredServer) ? preferredServer : 'vidsrc';
  }

  accentPresets.forEach(color => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'preset-btn';
    btn.style.background = color;
    btn.setAttribute('aria-label', `Set accent to ${color}`);
    btn.addEventListener('click', () => {
      accentPicker.value = color;
      applySettings({ accent: color });
    });
    presetsContainer.appendChild(btn);
  });

  accentPicker.addEventListener('input', (event) => {
    applySettings({ accent: event.target.value });
  });

  backgroundSelect.addEventListener('change', (event) => {
    const nextBackground = event.target.value;
    customBackgroundRow.hidden = nextBackground !== 'custom';
    applySettings({ background: nextBackground });
  });

  customBackgroundPicker.addEventListener('input', (event) => {
    applySettings({ customBackground: event.target.value, background: 'custom' });
    backgroundSelect.value = 'custom';
    customBackgroundRow.hidden = false;
  });

  motionToggle.addEventListener('change', (event) => {
    applySettings({ motion: event.target.checked });
  });

  particleToggle.addEventListener('change', (event) => {
    applySettings({ particles: event.target.checked });
  });

  incognitoToggle.addEventListener('change', (event) => {
    applySettings({ incognito: event.target.checked });
  });

  serverSelect.addEventListener('change', (event) => {
    applySettings({ defaultServer: event.target.value });
  });

  resetThemeBtn.addEventListener('click', () => {
    if (!confirm('Reset theme to the default purple style?')) return;
    window.bilmTheme?.resetTheme?.();
    syncUI();
  });

  resetDataBtn.addEventListener('click', () => {
    const confirmReset = confirm('‚ö†Ô∏è This will erase all saved site data on your device. Continue?');
    if (!confirmReset) return;

    try {
      localStorage.clear();
      sessionStorage.clear();

      document.cookie.split(';').forEach(cookie => {
        const eqPos = cookie.indexOf('=');
        const name = eqPos > -1 ? cookie.slice(0, eqPos).trim() : cookie.trim();
        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;
      });

      alert('‚úÖ Site data cleared. Reloading fresh.');
      location.reload();
    } catch (err) {
      console.error('Error clearing data:', err);
      alert('‚ùå Something went wrong while clearing data.');
    }
  });

  window.addEventListener('DOMContentLoaded', syncUI);
  window.addEventListener('bilm:theme-changed', syncUI);
</script>

</body>
</html>
